# SPDX-License-Identifier: GPL-2.0+

variables:
  DEFAULT_ALL_TAG: "all"
  DEFAULT_AMD64_TAG: "amd64"
  DEFAULT_FAST_TAG: "fast"
  MIRROR_DOCKER: docker.io
  SJG_LAB: ""
  PLATFORM: linux/amd64,linux/arm64

default:
  tags:
    - ${DEFAULT_ALL_TAG}

workflow:
  rules:
    - when: always

# Grab our configured image.  The source for this is found
# in the u-boot tree at tools/docker/Dockerfile
image: ${MIRROR_DOCKER}/trini/u-boot-gitlab-ci-runner:jammy-20251013-26Nov2025

build all platforms in a single job:
  tags:
    - ${DEFAULT_FAST_TAG}
  script:
    # Prepare python environment
    - python3 -m venv /tmp/venv;
      . /tmp/venv/bin/activate;
      pip install -r tools/binman/requirements.txt
        -r tools/buildman/requirements.txt
    - ret=0;
      git config --global --add safe.directory "${CI_PROJECT_DIR}";
      ./tools/buildman/buildman -o /tmp -PEWM -x xtensa || ret=$?;
      if [[ $ret -ne 0 ]]; then
        ./tools/buildman/buildman -o /tmp -seP;
        exit $ret;
      fi;
